<link rel="import" href="../vendor/polymer/polymer.html">

<polymer-element name="gt-model" attributes="items url">
  <script>

    Polymer('gt-model', {
      domReady: function() {
        this.asyncMethod(function() {
          this.fetch(function() {
            this.items = this.items || [];
          });
        });
      },
      create: function(title) {
        var title = title || '';
        var newItem = {
          title: title
        };
        this.fire('gt-model-changed');
        return newItem;
      },
      save: function(item) {
        var _self = this;
        $.ajax({
          type:"POST",
          contentType: "application/json",
          url: _self.url,
          data: JSON.stringify(item),
          success: function(response, status){
            _self.items.push(response);
          }
        });
      },
      fetch: function(cb) {
        var _self = this;
        $.ajax({
          type: 'GET',
          url: _self.url,
          dataType: 'json',
          complete: function(response) {
            _self.items = response.responseJSON.items;
            cb();
          }
        });
      }

    });
  </script>
</polymer-element>